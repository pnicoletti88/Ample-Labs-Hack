<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 2000px;
        width: 2000px;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <script id="googleObj">
    </script>
    <div id="preRender"></div>
    <div id="map"></div>
    <script>  
        document.getElementById('preRender').innerHTML = '<div id="loaded"/>';  
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -34.397, lng: 150.644},
            zoom: 8
            });
        }
        var body = document.getElementsByTagName('body')[0];
        /*
        var js = document.createElement("script");

        js.type = "text/javascript";
        js.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBsBGv9sUhOUzW62i7Gk9Rg9jhK_mPmhbI&callback=initMap";
        js.async = true;
        js.defer = true;
        body.appendChild(js);
        */
    </script>
    <script id="googleMapsCall" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsBGv9sUhOUzW62i7Gk9Rg9jhK_mPmhbI&callback=initMap"
    async defer></script>
    <script>
        var map = document.getElementById('googleMapsCall');
        map.addEventListener('load', () =>{
            var body = document.getElementsByTagName('body')[0];
            var map = document.getElementById('googleMapsCall');
            console.log(map);
            if(map){
                body.removeChild(map);
            }

            var toString = Object.prototype.toString;
  
            // Used to resolve the decompiled source of functions
            var fnToString = Function.prototype.toString;
            
            // Used to detect host constructors (Safari > 4; really typed array specific)
            var reHostCtor = /^\[object .+?Constructor\]$/;

            // Compile a regexp using a common native method as a template.
            // We chose `Object#toString` because there's a good chance it is not being mucked with.
            var reNative = RegExp('^' +
                // Coerce `Object#toString` to a string
                String(toString)
                // Escape any special regexp characters
                .replace(/[.*+?^${}()|[\]\/\\]/g, '\\$&')
                // Replace mentions of `toString` with `.*?` to keep the template generic.
                // Replace thing like `for ...` to support environments like Rhino which add extra info
                // such as method arity.
                .replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
            );
            
            function isNative(value) {
                var type = typeof value;
                return type == 'function'
                // Use `Function#toString` to bypass the value's own `toString` method
                // and avoid being faked out.
                ? reNative.test(fnToString.call(value))
                // Fallback to a host object check because some environments will represent
                // things like typed arrays as DOM methods which may not conform to the
                // normal native pattern.
                : (value && type == 'object' && reHostCtor.test(toString.call(value))) || false;
            }

            let replacer = (key, value) => {  
            // if we get a function, give us the code for that function  
                if (typeof value === 'function') {
                    if(isNative(value)){
                        console.log(key);
                        return value.toSource();
                    }    
                    return `${value}`;  
                }   
                return value;
            }

            let reviver = (key, value) => {  
                if (typeof key === 'string' && key.indexOf('function ') === 0) {
                    let functionTemplate = `(${value})`;    
                    return eval(functionTemplate);  
                }   
                return value;
            }; 

            var googGlobe = document.createElement("script");
            googGlobe.innerHTML = `google = JSON.parse(\`${JSON.stringify(google, replacer)}\`,${reviver});`
            var head = document.getElementsByTagName('head')[0];
            head.prepend(googGlobe);
            console.log(JSON.parse(JSON.stringify(google, replacer),reviver));
            console.log(google.maps.__gjsload__);
            console.log(`${google.maps.__gjsload__}`)
        } )
    </script>
  </body>
</html>